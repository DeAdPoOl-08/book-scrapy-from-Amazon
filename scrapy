from csv import excel

from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
from selenium.webdriver.support import expected_conditions
from selenium.webdriver.support.ui import WebDriverWait
from webdriver_manager.chrome import ChromeDriverManager
import pandas as pd

driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()))

book_titles =[]
book_authors = []
book_prices = []
book_ratings = []
book_pages = []
book_languages = []
book_publishers = []
reading_ages = []
feedback_summaries = []
book_links = []

url = 'https://www.amazon.in/s?k=books'
driver.get(url)
book_urls = driver.find_elements(By.XPATH,"//a[@class='a-link-normal s-line-clamp-2 s-link-style a-text-normal']")
for url in book_urls:
    b_link = url.get_attribute('href')
    book_links.append(b_link)

count = 1

for link in book_links:
    driver.get(link)
    try:
        title = driver.find_element(By.XPATH, "//span[@class='a-size-large celwidget']").text
    except:
        title = "No title"
    print(count)
    print('Title',title)
    book_titles.append(title)

    try:
        author = driver.find_element(By.XPATH, "//span[@class='author notFaded']"
                                           "//a").text
    except:
        author = "No author"
    print('Author',author)
    book_authors.append(author)

    try:
        # price = driver.find_element(By.XPATH, "//span[@class='a-price-whole']").text
        price = WebDriverWait(driver, 10).until(expected_conditions.presence_of_element_located((By.XPATH, "//span[@class='a-price-whole']"))).text
    except:
        price = 'No price'
    print(f'Price: {price}')
    book_prices.append(price)

    try:
        rating = driver.find_element(By.XPATH, "//span[@id='acrPopover']")
        rating = rating.get_attribute('title')
    except:
        rating = "No rating"
    print(f'Rating: {rating}')
    book_ratings.append(rating)

    try:
        page = driver.find_element(By.XPATH, "//div[@class='a-section a-spacing-none a-text-center rpi-attribute-value']"
                                             "//span[contains(text(), 'pages')]").text
    except:
        page = "No page"
    book_pages.append(page)
    print(f'Page number: {page}')


    count +=1
